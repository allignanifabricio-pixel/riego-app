<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cuidado de √Årboles</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2e7d32">

<style>
:root{
  --verde:#2e7d32;
  --azul:#1565c0;
  --fondo:#f2f4f7;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:var(--fondo);
}

header{
  background:linear-gradient(90deg,#2e7d32,#3fa35c);
  color:white;
  padding:20px;
  font-size:22px;
  font-weight:bold;
  text-align:center;
}

.reminder{
  background:white;
  margin:15px;
  padding:15px;
  border-radius:15px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  font-size:16px;
}

.week-bar{
  display:flex;
  justify-content:space-around;
  padding:10px;
  background:white;
  box-shadow:0 2px 5px rgba(0,0,0,0.08);
}

.day-pill{
  text-align:center;
  font-size:14px;
  color:#666;
  cursor:pointer;
  padding:6px 10px;
  border-radius:20px;
}

.day-pill.active{
  background:var(--azul);
  color:white;
}

.container{
  padding:15px;
}

.tree-card{
  border-radius:15px;
  padding:15px;
  margin-bottom:15px;
  color:white;
  box-shadow:0 6px 12px rgba(0,0,0,0.1);
}

.tree-card h3{
  margin:0;
  font-size:20px;
}

.tree-card p{
  margin:5px 0 15px 0;
  opacity:0.9;
}

.actions{
  display:flex;
  justify-content:space-between;
}

.actions button{
  flex:1;
  margin:0 5px;
  padding:8px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}

.edit{
  background:#1976d2;
  color:white;
}

.delete{
  background:#d32f2f;
  color:white;
}

#addBtn{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  width:85%;
  padding:15px;
  border-radius:30px;
  border:none;
  font-size:18px;
  font-weight:bold;
  background:#2e7d32;
  color:white;
  cursor:pointer;
  box-shadow:0 6px 12px rgba(0,0,0,0.2);
}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
}

.modal-content{
  background:white;
  padding:20px;
  border-radius:15px;
  width:90%;
  max-width:400px;
}

.modal input, .modal button{
  width:100%;
  padding:10px;
  margin:5px 0;
}
</style>
</head>
<body>

<header>Cuidado de √Årboles</header>

<div class="reminder">
  üîî Sistema autom√°tico de riego activo
</div>

<div class="week-bar" id="weekBar"></div>

<div class="container" id="treeContainer"></div>

<button id="addBtn" onclick="abrirModal()">+ Agregar √Årbol</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Agregar / Editar</h3>
    <input type="hidden" id="editId">
    <input id="nombre" placeholder="Nombre del √°rbol">
    <input id="frecuencia" type="number" placeholder="Cada cu√°ntos d√≠as">
    <input id="fechaInicio" type="date">
    <button onclick="guardar()">Guardar</button>
    <button onclick="cerrarModal()">Cancelar</button>
  </div>
</div>

<script>
let arboles = JSON.parse(localStorage.getItem("arboles")) || [];
let selectedDate = new Date().toISOString().split("T")[0];

const diasSemana = ["Lun","Mar","Mi√©","Jue","Vie","S√°b","Dom"];

function getMonday(date){
  const d = new Date(date);
  const day = d.getDay();
  const diff = d.getDate() - day + (day === 0 ? -6 : 1);
  return new Date(d.setDate(diff));
}

function diasEntre(fecha1, fecha2){
  const f1 = new Date(fecha1);
  const f2 = new Date(fecha2);
  return Math.floor((f2 - f1) / (1000*60*60*24));
}

function correspondeRiego(arbol, fecha){
  const diff = diasEntre(arbol.fechaInicio, fecha);
  if(diff < 0) return false;
  return diff % arbol.frecuencia === 0;
}

function render(){
  renderWeek();
  renderTrees();
}

function renderWeek(){
  const weekBar = document.getElementById("weekBar");
  weekBar.innerHTML="";

  const monday = getMonday(new Date());

  for(let i=0;i<7;i++){
    const d = new Date(monday);
    d.setDate(monday.getDate()+i);

    const fechaStr = d.toISOString().split("T")[0];

    const div=document.createElement("div");
    div.className="day-pill";
    if(fechaStr===selectedDate) div.classList.add("active");

    div.innerHTML=`
      <div>${diasSemana[i]}</div>
      <div>${d.getDate()}</div>
    `;

    div.onclick=()=>{
      selectedDate=fechaStr;
      render();
    };

    weekBar.appendChild(div);
  }
}

function renderTrees(){
  const container = document.getElementById("treeContainer");
  container.innerHTML="";

  const lista = arboles.filter(a=>correspondeRiego(a, selectedDate));

  if(lista.length===0){
    container.innerHTML="<p>No hay riegos este d√≠a</p>";
    return;
  }

  lista.forEach(a=>{
    const card=document.createElement("div");
    card.className="tree-card";

    const colores=[
      "linear-gradient(135deg,#2e7d32,#43a047)",
      "linear-gradient(135deg,#1565c0,#42a5f5)",
      "linear-gradient(135deg,#ef6c00,#ffa726)"
    ];

    card.style.background=colores[Math.floor(Math.random()*colores.length)];

    card.innerHTML=`
      <h3>${a.nombre}</h3>
      <p>Regar cada ${a.frecuencia} d√≠as</p>
      <div class="actions">
        <button class="edit" onclick="editar(${a.id})">Editar</button>
        <button class="delete" onclick="borrar(${a.id})">Borrar</button>
      </div>
    `;

    container.appendChild(card);
  });
}

function abrirModal(){
  document.getElementById("modal").style.display="flex";
  document.getElementById("nombre").value="";
  document.getElementById("frecuencia").value="";
  document.getElementById("editId").value="";
  document.getElementById("fechaInicio").value=selectedDate;
}

function cerrarModal(){
  document.getElementById("modal").style.display="none";
}

function guardar(){
  const nombre=document.getElementById("nombre").value.trim();
  const frecuencia=parseInt(document.getElementById("frecuencia").value);
  const fechaInicio=document.getElementById("fechaInicio").value;
  const id=document.getElementById("editId").value;

  if(!nombre||!frecuencia||!fechaInicio) return;

  if(id){
    const index=arboles.findIndex(a=>a.id==id);
    arboles[index]={id:Number(id),nombre,frecuencia,fechaInicio};
  }else{
    arboles.push({id:Date.now(),nombre,frecuencia,fechaInicio});
  }

  localStorage.setItem("arboles",JSON.stringify(arboles));
  cerrarModal();
  render();
}

function borrar(id){
  arboles=arboles.filter(a=>a.id!==id);
  localStorage.setItem("arboles",JSON.stringify(arboles));
  render();
}

function editar(id){
  const a=arboles.find(a=>a.id===id);
  if(!a) return;
  abrirModal();
  document.getElementById("nombre").value=a.nombre;
  document.getElementById("frecuencia").value=a.frecuencia;
  document.getElementById("fechaInicio").value=a.fechaInicio;
  document.getElementById("editId").value=a.id;
}

render();

if (location.protocol !== 'file:' && 'serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
