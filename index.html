<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App de Riego</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4caf50">

<style>
body { margin:0; font-family: Arial, sans-serif; background:#f0f5f0; }
header { background:#4caf50; color:white; padding:20px; text-align:center; font-size:24px; }
#controls { display:flex; justify-content:space-between; padding:10px; }
#calendar { display:flex; padding:10px; gap:6px; }
.dia { flex:1; background:#a5d6a7; border-radius:12px; padding:5px; }
.dia h4 { margin:4px 0; text-align:center; }
.fecha { text-align:center; font-size:12px; }

.arbol {
  margin:4px 0;
  padding:6px;
  border-radius:10px;
  text-align:center;
  cursor:pointer;
  position:relative;
  font-size:13px;
}

.arbol.hoy { background:#ff8a80; }
.arbol.manana { background:#ffcc80; }
.arbol.ok { background:#c8e6c9; }

.tooltip {
  position:absolute;
  background:white;
  padding:10px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
  font-size:14px;
  display:none;
  width:220px;
  z-index:10;
}

#btnAgregar {
  width:90%;
  margin:20px auto;
  display:block;
  padding:15px;
  font-size:18px;
  border:none;
  border-radius:16px;
  background:#4caf50;
  color:white;
}
</style>
</head>

<body>

<header>ðŸŒ¿ App de Riego</header>

<div id="controls">
  <button onclick="cambiarSemana(-7)">â—€ Semana anterior</button>
  <button onclick="cambiarSemana(7)">Semana siguiente â–¶</button>
</div>

<div id="calendar"></div>

<button id="btnAgregar">âž• Agregar Ã¡rbol</button>

<script>
let arboles = JSON.parse(localStorage.getItem("arboles") || "[]");
let inicioSemana = obtenerLunes(new Date());

function obtenerLunes(fecha){
  const d = new Date(fecha);
  const day = d.getDay() || 7;
  d.setDate(d.getDate() - day + 1);
  d.setHours(0,0,0,0);
  return d;
}

function guardar(){ localStorage.setItem("arboles", JSON.stringify(arboles)); }

function cambiarSemana(dias){
  inicioSemana.setDate(inicioSemana.getDate()+dias);
  render();
}

function render(){
  const cal = document.getElementById("calendar");
  cal.innerHTML="";
  const dias = ["Lun","Mar","MiÃ©","Jue","Vie","SÃ¡b","Dom"];
  const hoy = new Date(); hoy.setHours(0,0,0,0);

  for(let i=0;i<7;i++){
    const fecha = new Date(inicioSemana);
    fecha.setDate(fecha.getDate()+i);

    const div = document.createElement("div");
    div.className="dia";
    div.innerHTML=`<h4>${dias[i]}</h4>
                   <div class="fecha">${fecha.getDate()}/${fecha.getMonth()+1}</div>`;

    arboles.forEach(arbol=>{
      const ingreso = new Date(arbol.ingreso);
      ingreso.setHours(0,0,0,0);

      const diff = Math.floor((fecha - ingreso)/(1000*60*60*24));
      if(diff>=0 && diff % arbol.frecuencia === 0){
        const a = document.createElement("div");
        a.className="arbol";
        a.textContent=arbol.nombre;

        const diffHoy = Math.floor((fecha - hoy)/(1000*60*60*24));
        if(diffHoy===0) a.classList.add("hoy");
        else if(diffHoy===1) a.classList.add("manana");
        else a.classList.add("ok");

        const tip=document.createElement("div");
        tip.className="tooltip";
        const prox=new Date(fecha);
        prox.setDate(prox.getDate()+arbol.frecuencia);
        const ds=["Dom","Lun","Mar","MiÃ©","Jue","Vie","SÃ¡b"];
        tip.innerHTML=`
          <b>Frecuencia:</b> cada ${arbol.frecuencia} dÃ­as<br>
          <b>PrÃ³ximo riego:</b> ${ds[prox.getDay()]} ${prox.getDate()}
        `;
        a.appendChild(tip);
        a.onmouseenter=()=>tip.style.display="block";
        a.onmouseleave=()=>tip.style.display="none";

        div.appendChild(a);
      }
    });

    cal.appendChild(div);
  }
}

document.getElementById("btnAgregar").onclick=()=>{
  const n=prompt("Nombre del Ã¡rbol");
  const f=prompt("Cada cuÃ¡ntos dÃ­as se riega");
  if(n && f){
    arboles.push({nombre:n, frecuencia:parseInt(f), ingreso:new Date()});
    guardar(); render();
  }
};

function notificacionDiaria(){
  if(Notification.permission!=="granted") return;
  const hoy=new Date(); hoy.setHours(0,0,0,0);
  let lista=[];
  arboles.forEach(a=>{
    const ing=new Date(a.ingreso); ing.setHours(0,0,0,0);
    const diff=Math.floor((hoy-ing)/(1000*60*60*24));
    if(diff>=0 && diff%a.frecuencia===0) lista.push(a.nombre);
  });
  new Notification("ðŸŒ± Riego",{
    body: lista.length ? 
      `Hoy regar: ${lista.join(", ")}` :
      "Hoy no hay Ã¡rboles para regar ðŸŒ¿"
  });
}

window.onload=()=>{
  Notification.requestPermission();
  notificacionDiaria();
  render();
};

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>