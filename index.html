<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App de Riego</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4caf50">

<style>
body { font-family: Arial, sans-serif; margin:0; background:#f0f5f0;}
header { background:#4caf50; color:white; text-align:center; padding:20px; font-size:24px; }
#controls { display:flex; justify-content:space-between; padding:10px; }
#calendar { display:flex; justify-content:space-around; padding:10px; }
.dia { width:14%; background:#a5d6a7; border-radius:10px; padding:5px; min-height:90px; }
.dia h4 { margin:4px 0; font-size:14px; text-align:center; }
.fecha { font-size:12px; text-align:center; }
.arbol { background:#c8e6c9; margin:4px 0; padding:6px; border-radius:10px; text-align:center; cursor:pointer; position:relative; }

.tooltip {
  position:absolute;
  background:white;
  padding:10px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
  font-size:14px;
  display:none;
  z-index:10;
  width:220px;
}

#btnAgregar {
  width:90%;
  margin:20px auto;
  display:block;
  padding:15px;
  font-size:18px;
  border:none;
  border-radius:16px;
  background:#4caf50;
  color:white;
}
</style>
</head>

<body>

<header>üåø App de Riego</header>

<div id="controls">
  <button onclick="cambiarSemana(-7)">‚óÄ Semana anterior</button>
  <button onclick="cambiarSemana(7)">Semana siguiente ‚ñ∂</button>
</div>

<div id="calendar"></div>

<button id="btnAgregar">‚ûï Agregar √°rbol</button>

<script>
let arboles = JSON.parse(localStorage.getItem('arboles') || '[]');
let inicioSemana = obtenerLunes(new Date());

function obtenerLunes(fecha){
  const d = new Date(fecha);
  const day = d.getDay() || 7;
  d.setDate(d.getDate() - day + 1);
  d.setHours(0,0,0,0);
  return d;
}

function guardar(){ localStorage.setItem('arboles', JSON.stringify(arboles)); }

function cambiarSemana(dias){
  inicioSemana.setDate(inicioSemana.getDate()+dias);
  render();
}

function render(){
  const cal = document.getElementById('calendar');
  cal.innerHTML='';
  const dias=['Lun','Mar','Mi√©','Jue','Vie','S√°b','Dom'];

  for(let i=0;i<7;i++){
    const fecha = new Date(inicioSemana);
    fecha.setDate(fecha.getDate()+i);

    const div=document.createElement('div');
    div.className='dia';
    div.innerHTML=`<h4>${dias[i]}</h4>
                   <div class="fecha">${fecha.getDate()}/${fecha.getMonth()+1}</div>`;
    
    arboles.forEach(arbol=>{
      const ingreso=new Date(arbol.ingreso);
      ingreso.setHours(0,0,0,0);

      const diff=Math.floor((fecha-ingreso)/(1000*60*60*24));
      if(diff>=0 && diff%arbol.frecuencia===0){
        const a=document.createElement('div');
        a.className='arbol';
        a.textContent=arbol.nombre;

        const tip=document.createElement('div');
        tip.className='tooltip';

        const proximo=new Date(fecha);
        proximo.setDate(proximo.getDate()+arbol.frecuencia);

        const ds=['Dom','Lun','Mar','Mi√©','Jue','Vie','S√°b'];
        tip.innerHTML=`
          <b>Frecuencia:</b> cada ${arbol.frecuencia} d√≠as<br>
          <b>Pr√≥ximo riego:</b> ${ds[proximo.getDay()]} ${proximo.getDate()}
        `;

        a.appendChild(tip);
        a.onmouseenter=()=>tip.style.display='block';
        a.onmouseleave=()=>tip.style.display='none';

        div.appendChild(a);
      }
    });

    cal.appendChild(div);
  }
}

document.getElementById('btnAgregar').onclick=()=>{
  const n=prompt('Nombre del √°rbol');
  const f=prompt('Cada cu√°ntos d√≠as se riega');
  if(n && f){
    arboles.push({nombre:n, frecuencia:parseInt(f), ingreso:new Date()});
    guardar(); render();
  }
};

render();

// REGISTRO SERVICE WORKER
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>