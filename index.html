<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Cuidado de √Årboles</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2e7d32">

<style>
:root{
  --verde:#2e7d32;
  --azul:#1565c0;
  --fondo:#f2f4f7;
  --card:#ffffff;
  --texto:#222;
}

body.dark{
  --fondo:#121212;
  --card:#1e1e1e;
  --texto:#f5f5f5;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:var(--fondo);
  color:var(--texto);
  transition:0.3s;
}

/* HEADER */
header{
  background:linear-gradient(90deg,#2e7d32,#3fa35c);
  color:white;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:18px;
  font-weight:bold;
}

header button{
  background:none;
  border:none;
  color:white;
  font-size:18px;
  cursor:pointer;
}

/* SEMANA */
.week-nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px;
}

.week-bar{
  display:flex;
  justify-content:space-around;
  padding:10px;
  background:var(--card);
  border-radius:15px;
  margin:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

.day-pill{
  text-align:center;
  font-size:13px;
  cursor:pointer;
  padding:6px 8px;
  border-radius:20px;
  color:#777;
}

.day-pill.active{
  background:var(--azul);
  color:white;
}

/* TARJETAS */
.container{
  padding:10px;
}

.tree-card{
  border-radius:15px;
  padding:15px;
  margin-bottom:15px;
  color:white;
  box-shadow:0 6px 12px rgba(0,0,0,0.15);
  animation:fadeIn 0.3s ease;
}

@keyframes fadeIn{
  from{opacity:0; transform:translateY(10px);}
  to{opacity:1; transform:translateY(0);}
}

.tree-card h3{
  margin:0;
  font-size:18px;
  display:flex;
  align-items:center;
  gap:8px;
}

.tree-card p{
  margin:5px 0 15px 0;
  opacity:0.9;
}

.actions{
  display:flex;
  gap:10px;
}

.actions button{
  flex:1;
  padding:8px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}

.edit{ background:#1976d2; color:white; }
.delete{ background:#d32f2f; color:white; }

/* BOT√ìN */
#addBtn{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  width:85%;
  padding:15px;
  border-radius:30px;
  border:none;
  font-size:18px;
  font-weight:bold;
  background:#2e7d32;
  color:white;
  cursor:pointer;
  box-shadow:0 6px 12px rgba(0,0,0,0.3);
}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
}

.modal-content{
  background:var(--card);
  padding:20px;
  border-radius:15px;
  width:90%;
  max-width:400px;
}

.modal input, .modal button{
  width:100%;
  padding:10px;
  margin:5px 0;
}
</style>
</head>
<body>

<header>
  <button onclick="prevWeek()">‚óÄ</button>
  Cuidado de √Årboles
  <button onclick="toggleDark()">üåô</button>
</header>

<div class="week-bar" id="weekBar"></div>

<div class="container" id="treeContainer"></div>

<button id="addBtn" onclick="abrirModal()">+ Agregar √Årbol</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Agregar / Editar</h3>
    <input type="hidden" id="editId">
    <input id="nombre" placeholder="Nombre del √°rbol">
    <input id="frecuencia" type="number" placeholder="Cada cu√°ntos d√≠as">
    <input id="fechaInicio" type="date">
    <select id="icono">
      <option value="üå≥">üå≥ √Årbol</option>
      <option value="üå≤">üå≤ Pino</option>
      <option value="üçé">üçé Manzano</option>
      <option value="üå¥">üå¥ Palmera</option>
      <option value="üåµ">üåµ Cactus</option>
    </select>
    <button onclick="guardar()">Guardar</button>
    <button onclick="cerrarModal()">Cancelar</button>
  </div>
</div>

<script>
let arboles = JSON.parse(localStorage.getItem("arboles")) || [];
let semanaOffset = 0;
let selectedDate = new Date().toISOString().split("T")[0];

const diasSemana = ["Lun","Mar","Mi√©","Jue","Vie","S√°b","Dom"];

function getMonday(date){
  const d = new Date(date);
  const day = d.getDay();
  const diff = d.getDate() - day + (day === 0 ? -6 : 1);
  return new Date(d.setDate(diff));
}

function diasEntre(f1,f2){
  return Math.floor((new Date(f2)-new Date(f1))/(1000*60*60*24));
}

function corresponde(a,fecha){
  const diff=diasEntre(a.fechaInicio,fecha);
  if(diff<0) return false;
  return diff%a.frecuencia===0;
}

function render(){
  renderWeek();
  renderTrees();
}

function renderWeek(){
  const weekBar=document.getElementById("weekBar");
  weekBar.innerHTML="";

  const base=new Date();
  base.setDate(base.getDate()+semanaOffset*7);
  const monday=getMonday(base);

  for(let i=0;i<7;i++){
    const d=new Date(monday);
    d.setDate(monday.getDate()+i);
    const fechaStr=d.toISOString().split("T")[0];

    const div=document.createElement("div");
    div.className="day-pill";
    if(fechaStr===selectedDate) div.classList.add("active");

    div.innerHTML=`${diasSemana[i]}<br>${d.getDate()}`;

    div.onclick=()=>{
      selectedDate=fechaStr;
      render();
    };

    weekBar.appendChild(div);
  }
}

function renderTrees(){
  const container=document.getElementById("treeContainer");
  container.innerHTML="";

  const lista=arboles.filter(a=>corresponde(a,selectedDate));

  if(lista.length===0){
    container.innerHTML="<p style='text-align:center;'>No hay riegos este d√≠a</p>";
    return;
  }

  lista.forEach(a=>{
    const card=document.createElement("div");
    card.className="tree-card";

    const colores=[
      "linear-gradient(135deg,#2e7d32,#43a047)",
      "linear-gradient(135deg,#1565c0,#42a5f5)",
      "linear-gradient(135deg,#ef6c00,#ffa726)"
    ];
    card.style.background=colores[Math.floor(Math.random()*colores.length)];

    card.innerHTML=`
      <h3>${a.icono} ${a.nombre}</h3>
      <p>Regar cada ${a.frecuencia} d√≠as</p>
      <div class="actions">
        <button class="edit" onclick="editar(${a.id})">Editar</button>
        <button class="delete" onclick="borrar(${a.id})">Borrar</button>
      </div>
    `;
    container.appendChild(card);
  });
}

function prevWeek(){ semanaOffset--; render(); }
function nextWeek(){ semanaOffset++; render(); }

let touchStartX=0;
document.addEventListener("touchstart",e=>{
  touchStartX=e.changedTouches[0].screenX;
});
document.addEventListener("touchend",e=>{
  const diff=e.changedTouches[0].screenX-touchStartX;
  if(diff>50) prevWeek();
  if(diff<-50) nextWeek();
});

function toggleDark(){
  document.body.classList.toggle("dark");
}

function abrirModal(){
  document.getElementById("modal").style.display="flex";
  document.getElementById("nombre").value="";
  document.getElementById("frecuencia").value="";
  document.getElementById("editId").value="";
  document.getElementById("fechaInicio").value=selectedDate;
}

function cerrarModal(){
  document.getElementById("modal").style.display="none";
}

function guardar(){
  const nombre=nombreInput.value.trim();
  const frecuencia=parseInt(frecuenciaInput.value);
  const fechaInicio=fechaInicioInput.value;
  const icono=document.getElementById("icono").value;
  const id=editId.value;

  if(!nombre||!frecuencia||!fechaInicio) return;

  if(id){
    const index=arboles.findIndex(a=>a.id==id);
    arboles[index]={id:Number(id),nombre,frecuencia,fechaInicio,icono};
  }else{
    arboles.push({id:Date.now(),nombre,frecuencia,fechaInicio,icono});
  }

  localStorage.setItem("arboles",JSON.stringify(arboles));
  cerrarModal();
  render();
}

function borrar(id){
  arboles=arboles.filter(a=>a.id!==id);
  localStorage.setItem("arboles",JSON.stringify(arboles));
  render();
}

function editar(id){
  const a=arboles.find(a=>a.id===id);
  if(!a) return;
  abrirModal();
  nombreInput.value=a.nombre;
  frecuenciaInput.value=a.frecuencia;
  fechaInicioInput.value=a.fechaInicio;
  document.getElementById("icono").value=a.icono;
  editId.value=a.id;
}

const nombreInput=document.getElementById("nombre");
const frecuenciaInput=document.getElementById("frecuencia");
const fechaInicioInput=document.getElementById("fechaInicio");
const editId=document.getElementById("editId");

render();

if (location.protocol !== 'file:' && 'serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>