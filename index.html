<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">

<meta name="viewport"
      content="width=device-width,
               initial-scale=1,
               maximum-scale=1,
               user-scalable=no,
               viewport-fit=cover">

<title>Riego de √Årboles</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2e7d32">

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    background: #f1f8f4;
    touch-action: manipulation;
    overflow-x: hidden;
}

/* HEADER */
header {
    background: #2e7d32;
    color: white;
    padding: 16px;
    text-align: center;
    font-size: 20px;
}

/* CONTROLES */
.controles {
    display: flex;
    gap: 8px;
    padding: 8px;
}

.controles button {
    flex: 1;
    padding: 14px;
    font-size: 16px;
    border-radius: 14px;
    border: none;
    background: #4caf50;
    color: white;
}

/* CALENDARIO */
#calendario {
    display: grid;
    grid-template-columns: repeat(7, minmax(0, 1fr));
    gap: 6px;
    padding: 8px;
    width: 100vw;
}

/* D√çA */
.dia {
    background: white;
    border-radius: 14px;
    padding: 6px;
    min-height: 120px;
    position: relative;
    min-width: 0;
    overflow: hidden;
}

.fecha {
    font-size: 13px;
    font-weight: bold;
    margin-bottom: 4px;
}

.hoy {
    border: 2px solid #2e7d32;
}

/* TARJETAS */
.arbol {
    margin-top: 4px;
    padding: 8px;
    border-radius: 12px;
    color: white;
    font-size: 13px;
}

.urgente { background: #e53935; }
.pronto { background: #fbc02d; color:#333; }
.normal { background: #43a047; }

.nombre {
    text-align: center;
    font-weight: bold;
    word-break: break-word;
}

/* BOTONES EN TARJETA */
.acciones {
    display: flex;
    justify-content: space-around;
    margin-top: 6px;
}

.acciones button {
    font-size: 16px;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    border: none;
    background: rgba(255,255,255,.25);
    color: white;
}

/* SIN RIEGOS */
.sin-arboles {
    font-size: 11px;
    color: #bbb;
    text-align: center;
    margin-top: 18px;
}

/* TOOLTIP */
.tooltip {
    position: absolute;
    background: white;
    color: #333;
    padding: 12px;
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,.3);
    font-size: 13px;
    width: 200px;
    z-index: 100;
}

/* BOT√ìN AGREGAR */
#agregar {
    position: fixed;
    bottom: calc(16px + env(safe-area-inset-bottom));
    right: calc(16px + env(safe-area-inset-right));
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: #2e7d32;
    color: white;
    font-size: 34px;
    border: none;
    box-shadow: 0 8px 20px rgba(0,0,0,.35);
}

/* MODAL */
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.45);
    display: none;
    align-items: center;
    justify-content: center;
}

.modal.activo { display: flex; }

.modal-contenido {
    background: white;
    border-radius: 18px;
    padding: 20px;
    width: 90%;
    max-width: 320px;
}

.modal-contenido input {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    margin-bottom: 12px;
    border-radius: 12px;
    border: 1px solid #ccc;
}

.modal-contenido button {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    border-radius: 14px;
    border: none;
    margin-top: 8px;
}

.guardar { background:#2e7d32; color:white; }
.cancelar { background:#ccc; }
</style>
</head>

<body>

<header>üåø Riego de √Årboles</header>

<div class="controles">
    <button onclick="cambiarSemana(-1)">‚óÄ Semana</button>
    <button onclick="cambiarSemana(1)">Semana ‚ñ∂</button>
</div>

<div id="calendario"></div>

<button id="agregar" onclick="abrirModal()">Ôºã</button>

<div class="modal" id="modal">
    <div class="modal-contenido">
        <input id="nombre" placeholder="Nombre del √°rbol">
        <input id="frecuencia" type="number" placeholder="Frecuencia (d√≠as)">
        <button class="guardar" onclick="guardarArbol()">Guardar</button>
        <button class="cancelar" onclick="cerrarModal()">Cancelar</button>
    </div>
</div>

<script>
let arboles = JSON.parse(localStorage.getItem("arboles")) || [];
let semanaOffset = 0;
let editIndex = null;

function cambiarSemana(d) {
    semanaOffset += d;
    render();
}

function render() {
    const cal = document.getElementById("calendario");
    cal.innerHTML = "";

    const hoy = new Date(); hoy.setHours(0,0,0,0);
    const inicio = new Date(hoy);
    inicio.setDate(hoy.getDate() - hoy.getDay() + semanaOffset * 7);

    for (let i = 0; i < 7; i++) {
        const fecha = new Date(inicio);
        fecha.setDate(inicio.getDate() + i);

        const dia = document.createElement("div");
        dia.className = "dia";
        if (+fecha === +hoy) dia.classList.add("hoy");

        dia.innerHTML = `<div class="fecha">${fecha.getDate()}</div>`;
        let hay = false;

        arboles.forEach((a, idx) => {
            const ini = new Date(a.fecha);
            ini.setHours(0,0,0,0);
            const diff = Math.floor((fecha - ini) / 86400000);

            if (diff >= 0 && diff % a.freq === 0) {
                hay = true;
                const urg = diff === 0 ? "urgente" : diff <= 2 ? "pronto" : "normal";

                const card = document.createElement("div");
                card.className = `arbol ${urg}`;
                card.innerHTML = `
                    <div class="nombre">${a.nombre}</div>
                    <div class="acciones">
                        <button onclick="abrirModal(${idx})">‚úèÔ∏è</button>
                        <button onclick="borrar(${idx})">üóë</button>
                    </div>
                `;
                dia.appendChild(card);
            }
        });

        if (!hay) dia.innerHTML += `<div class="sin-arboles">Sin riegos</div>`;
        cal.appendChild(dia);
    }
}

function abrirModal(i = null) {
    editIndex = i;
    modal.classList.add("activo");
    if (i !== null) {
        nombre.value = arboles[i].nombre;
        frecuencia.value = arboles[i].freq;
    } else {
        nombre.value = "";
        frecuencia.value = "";
    }
}

function cerrarModal() {
    modal.classList.remove("activo");
}

function guardarArbol() {
    if (!nombre.value || !frecuencia.value) return;
    const data = {
        nombre: nombre.value,
        freq: +frecuencia.value,
        fecha: new Date().toISOString().split("T")[0]
    };
    if (editIndex !== null) arboles[editIndex] = data;
    else arboles.push(data);
    localStorage.setItem("arboles", JSON.stringify(arboles));
    cerrarModal();
    render();
}

function borrar(i) {
    if (confirm("¬øEliminar este √°rbol?")) {
        arboles.splice(i, 1);
        localStorage.setItem("arboles", JSON.stringify(arboles));
        render();
    }
}

render();
</script>

</body>
</html>
üéâ Resultad